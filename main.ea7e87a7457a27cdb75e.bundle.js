(()=>{"use strict";class e{constructor(e,t){this.x=e,this.y=t}}class t{constructor(e){this.image=new Image,this.image.src=e}}function i(e,t,i,s){const n=t.x,a=t.y,o=.5*e.image.width,h=.5*e.image.height,r=s.x,c=s.y,d=.6*i.image.width,g=.6*i.image.height;return n<r+d&&n+o>r&&a<c+g&&a+h>c}var s,n,a,o;!function(e){e[e.IDLE=0]="IDLE",e[e.RUNNING=1]="RUNNING",e[e.JUMPING=2]="JUMPING",e[e.FALLING=3]="FALLING",e[e.CROUCHING=4]="CROUCHING",e[e.DEAD=5]="DEAD"}(s||(s={}));class h{constructor(t=new e(0,0)){this.animationStep=6,this.speed=1.15,this.maxJumpHeight=20,this.gravity=2,this.frameIndex=0,this.dinoState=s.IDLE,this.position=t,this.animations=new Map,this.setRenderResource()}setRenderResource(){let e=new t("assets\\Dinosaur\\dinosaurIdle.png"),i=[e];this.animations.set("Idle",i);let s=[new t("assets\\Dinosaur\\dinosaurDead.png")];this.animations.set("Dead",s);let n=[new t("assets\\Dinosaur\\dinosaurJump.png")];this.animations.set("Jump",n);let a=[new t("assets\\Dinosaur\\dinosaurRunFrame1.png"),new t("assets\\Dinosaur\\dinosaurRunFrame2.png")];this.animations.set("Run",a);let o=[new t("assets\\Dinosaur\\dinosaurCrouchFrame1.png"),new t("assets\\Dinosaur\\dinosaurCrouchFrame2.png")];this.animations.set("Crouch",o),this.nowPlayingAnimation="Idle",this.nowRenderingSprite=e}getRenderResource(){return this.animations.get(this.nowPlayingAnimation)}render(e){e.drawImage(this.nowRenderingSprite.image,this.position.x,this.position.y)}update(e,t){let i=this.getRenderResource();this.frameIndex+=1;let n=Math.floor(this.frameIndex/this.animationStep)%(this.animationStep*i.length);switch(i[n%i.length].image!=this.nowRenderingSprite.image&&(this.nowRenderingSprite=i[n%i.length]),this.dinoState){case s.JUMPING:this.position.y-=e*Math.sqrt(t)*this.speed*5,this.position.y<=this.maxJumpHeight&&(this.dinoState=s.FALLING);case s.FALLING:this.position.y+=e*Math.sqrt(t)*this.speed*this.gravity,this.position.y>=145&&(this.gravity=2,this.position.y=145,this.dinoState=s.RUNNING,this.setAnimation("Run"))}}setAnimation(e){"Crouch"==e&&(this.position.y=145,this.position.y+=20,this.dinoState=s.CROUCHING,this.nowPlayingAnimation=e,console.log(" asdasdasd")),"Jump"==e&&this.dinoState!=s.CROUCHING&&this.dinoState!=s.FALLING&&(this.dinoState=s.JUMPING,this.nowPlayingAnimation=e),"Run"==e&&(this.position.y=145,this.dinoState=s.RUNNING,this.nowPlayingAnimation=e),"Dead"==e&&(this.dinoState=s.DEAD,this.nowPlayingAnimation=e),"Idle"==e&&(this.nowPlayingAnimation=e,this.nowRenderingSprite=this.getRenderResource()[0])}reset(){this.dinoState=s.IDLE,this.frameIndex=0,this.setAnimation("Idle"),this.position.x=10,this.position.y=145}}class r{constructor(t){t||(t=new e(0,0)),this.speed=.25,this.position=t,this.setRenderResource()}setRenderResource(){this.nowRenderingSprite=new t("assets\\Environment\\ground.png")}getRenderResource(){return[this.nowRenderingSprite]}render(e){e.drawImage(this.nowRenderingSprite.image,this.position.x,this.position.y),e.drawImage(this.nowRenderingSprite.image,this.position.x+this.nowRenderingSprite.image.width,this.position.y)}update(e,t){this.position.x-=e*t*this.speed,this.speed<2?this.speed+=1e-4:this.speed=2,this.position.x<-this.nowRenderingSprite.image.width&&(this.position.x=0)}reset(){this.speed=.25,this.position.x=0}}class c{constructor(e=600,t=200){this.createCanvas(e,t),this.canvasContext=this.canvas.getContext("2d"),this.height=t,this.width=e}clear(){this.canvasContext.clearRect(0,0,this.width,this.height)}draw(){this.canvasContext.fillStyle="white",this.canvasContext.fillRect(0,0,this.width,this.height)}getWidth(){return this.width}getHeight(){return this.height}createCanvas(e=600,t=200){let i=document.getElementById("game");this.canvas=document.createElement("canvas"),this.canvas.id="canvas",this.canvas.height=t,this.canvas.width=e,null==i||i.appendChild(this.canvas)}}class d{constructor(e){this.animationStep=60,this.speed=.25,this.frameIndex=0,this.position=e,this.bird=[],this.setRenderResource()}setRenderResource(){let e=new t("assets\\NPC\\bird1.png"),i=new t("assets\\NPC\\bird2.png");this.bird.push(e),this.bird.push(i),this.nowRenderingSprite=e}getRenderResource(){return this.bird}render(e){e.drawImage(this.nowRenderingSprite.image,this.position.x,this.position.y)}update(e,t){if(0!=e){let i=this.getRenderResource();this.frameIndex+=1;let s=Math.floor(this.frameIndex/this.animationStep)%(this.animationStep*i.length);i[s%i.length].image!=this.nowRenderingSprite.image&&(this.nowRenderingSprite=i[s%i.length]),this.position.x-=e*t*this.speed,this.speed<2?this.speed+=15e-5:this.speed=2,this.position.x<-100&&(this.position.x=800,this.position.y=g(70,125))}}reset(){this.speed=.25,this.position.x=1200,this.position.y=g(70,125)}}function g(e,t){const i=Math.random()*(t-e)+e;return Math.floor(i)}class p{constructor(t){t||(t=new e(0,0)),this.cacheCactus=new Map,this.cacheSmallCactus=new Map,this.speed=.25,this.position=t,this.DEFAULT_GROUND=145,this.cacheRenderResource(),this.setRenderResource()}cacheRenderResource(){this.cacheCactus.set(1,new t("assets\\Environment\\cactus1.png")),this.cacheCactus.set(2,new t("assets\\Environment\\cactus2.png")),this.cacheCactus.set(3,new t("assets\\Environment\\cactus3.png")),this.cacheCactus.set(4,new t("assets\\Environment\\cactus4.png")),this.cacheCactus.set(5,new t("assets\\Environment\\cactus5.png")),this.cacheCactus.set(6,new t("assets\\Environment\\cactus6.png")),this.cacheSmallCactus.set(1,new t("assets\\Environment\\smallCactus1.png")),this.cacheSmallCactus.set(2,new t("assets\\Environment\\smallCactus2.png")),this.cacheSmallCactus.set(3,new t("assets\\Environment\\smallCactus3.png")),this.cacheSmallCactus.set(4,new t("assets\\Environment\\smallCactus4.png")),this.cacheSmallCactus.set(5,new t("assets\\Environment\\smallCactus5.png")),this.cacheSmallCactus.set(6,new t("assets\\Environment\\smallCactus6.png"))}setRenderResource(){this.position.y=this.DEFAULT_GROUND;let e=Math.floor(5*Math.random())+1;0==Math.floor(2*Math.random())?this.nowRenderingSprite=this.cacheCactus.get(e):(this.nowRenderingSprite=this.cacheSmallCactus.get(e),this.position.y+=15)}getRenderResource(){return[this.nowRenderingSprite]}render(e){e.drawImage(this.nowRenderingSprite.image,this.position.x,this.position.y)}update(e,t){this.position.x-=e*t*this.speed,this.speed<2?this.speed+=1e-4:this.speed=2,this.position.x<-this.nowRenderingSprite.image.width&&(this.position.x=800,this.setRenderResource())}reset(){this.speed=.25,this.position.x=800,this.setRenderResource()}}class m{constructor(t){t||(t=new e(0,0)),this.speed=.25,this.position=t,this.setRenderResource()}setRenderResource(){this.nowRenderingSprite=new t("assets\\Environment\\cloud.png")}getRenderResource(){return[this.nowRenderingSprite]}render(e){e.drawImage(this.nowRenderingSprite.image,this.position.x,this.position.y),e.drawImage(this.nowRenderingSprite.image,this.position.x+7*this.nowRenderingSprite.image.width,this.position.y+30),e.drawImage(this.nowRenderingSprite.image,this.position.x+3*this.nowRenderingSprite.image.width,this.position.y+50)}update(e,t){this.position.x-=e*t*this.speed,this.position.x<-this.nowRenderingSprite.image.width&&(this.position.x=800)}reset(){}}class u{constructor(i,s){null==s&&(s=0),null==i&&(i=new e(0,0)),this.position=i,this.score=0,this.isEndGame=!1,this.nowRenderingSprite=[],this.cacheDigit=new Map;for(let e=0;e<14;e++)this.nowRenderingSprite.push(new t("assets\\UI\\0.png"));this.cacheRenderResource(),u.highScore=s,this.setRenderResource()}cacheRenderResource(){this.cacheDigit.set(0,new t("assets\\UI\\0.png")),this.cacheDigit.set(1,new t("assets\\UI\\1.png")),this.cacheDigit.set(2,new t("assets\\UI\\2.png")),this.cacheDigit.set(3,new t("assets\\UI\\3.png")),this.cacheDigit.set(4,new t("assets\\UI\\4.png")),this.cacheDigit.set(5,new t("assets\\UI\\5.png")),this.cacheDigit.set(6,new t("assets\\UI\\6.png")),this.cacheDigit.set(7,new t("assets\\UI\\7.png")),this.cacheDigit.set(8,new t("assets\\UI\\8.png")),this.cacheDigit.set(9,new t("assets\\UI\\9.png"))}setRenderResource(){this.nowRenderingSprite[0]=new t("assets\\UI\\h.png"),this.nowRenderingSprite[1]=new t("assets\\UI\\i.png"),this.nowRenderingSprite[12]=new t("assets\\UI\\gameOver.png"),this.nowRenderingSprite[13]=new t("assets\\UI\\replay.png"),this.setHighScoreResources(),this.setScoreResources(0)}setHighScoreResources(){u.highScore>99999&&(u.highScore=99999),this.score>u.highScore&&(u.highScore=this.score);let e=u.highScore.toString();for(let t=0;5-e.length;t++)e="0"+e;for(let t=2;t<7;t++){let i=parseInt(e[t-2]);this.nowRenderingSprite[t]=this.cacheDigit.get(i)}}setScoreResources(e){e>99999&&(e=99999);let t=e.toString();for(let e=0;5-t.length;e++)t="0"+t;for(let e=7;e<12;e++){let i=parseInt(t[e-7]);this.nowRenderingSprite[e]=this.cacheDigit.get(i)}}getRenderResource(){return this.nowRenderingSprite}render(e){let t=this.getRenderResource(),i=15;e.drawImage(t[0].image,this.position.x,this.position.y),e.drawImage(t[1].image,this.position.x+i,this.position.y),i+=30;for(let s=2;s<7;s++)e.drawImage(t[s].image,this.position.x+i,this.position.y),i+=15;i+=15;for(let s=7;s<12;s++)e.drawImage(t[s].image,this.position.x+i,this.position.y),i+=15;this.isEndGame&&(e.drawImage(t[12].image,275,125),e.drawImage(t[13].image,350,75))}update(e,t){this.score+=Math.floor(e*t*.25),this.setScoreResources(this.score),0==e&&(this.isEndGame=!0)}reset(){this.score=0,this.setScoreResources(this.score),this.isEndGame=!1}}u.highScore=0,function(e){e[e.READY=0]="READY",e[e.PLAYING=1]="PLAYING",e[e.PAUSE=2]="PAUSE",e[e.ENDGAME=3]="ENDGAME"}(n||(n={})),function(e){e[e.READY=0]="READY",e[e.PLAYING=1]="PLAYING",e[e.PAUSE=2]="PAUSE",e[e.ENDGAME=3]="ENDGAME"}(a||(a={})),function(e){e[e.IDLE=0]="IDLE",e[e.RUNNING=1]="RUNNING",e[e.JUMPING=2]="JUMPING",e[e.FALLING=3]="FALLING",e[e.CROUCHING=4]="CROUCHING",e[e.DEAD=5]="DEAD"}(o||(o={}));let w=new Set,l=new Set,R=new class{constructor(){this.timeScale=.75,this.canvas=new c(800,200),this.renderables=[],this.dino=new h(new e(10,145)),this.bird=new d(new e(1200,125)),this.ground=new r(new e(0,180)),this.cactus=new p(new e(800,145)),this.cloud=new m(new e(800,100)),this.uiElements=new u(new e(550,20)),this.renderables.push(this.dino),this.renderables.push(this.bird),this.renderables.push(this.ground),this.renderables.push(this.cloud),this.renderables.push(this.cactus),this.renderables.push(this.uiElements),this.gameState=n.READY}update(e){for(const t of this.renderables)t.update(this.timeScale,e);(i(this.dino.nowRenderingSprite,this.dino.position,this.cactus.nowRenderingSprite,this.cactus.position)||i(this.dino.nowRenderingSprite,this.dino.position,this.bird.nowRenderingSprite,this.bird.position))&&this.gameState!=n.ENDGAME&&(this.dino.setAnimation("Dead"),this.gameState=n.ENDGAME,this.timeScale=0,this.uiElements.setHighScoreResources())}render(){this.canvas.clear(),this.canvas.draw();let e=this.canvas.canvasContext;for(const t of this.renderables)t.render(e)}replay(){for(const e of this.renderables)e.reset();this.gameState=n.READY,this.timeScale=.75}setGameState(e){e in n&&(this.gameState=e)}getGameState(){return this.gameState}},S=performance.now();function I(e){let t=e.key;w.has(t)||(w.add(t),l.add(t),R.getGameState()!==a.READY||" "!==t&&"ArrowUp"!==t?R.getGameState()!=a.PLAYING||" "!==t&&"ArrowUp"!==t?R.getGameState()==a.PLAYING&&"ArrowDown"===t?R.dino.dinoState!=o.FALLING&&R.dino.dinoState!=o.JUMPING?R.dino.setAnimation("Crouch"):R.dino.gravity=4:R.getGameState()==a.ENDGAME&&" "===t&&R.replay():R.dino.setAnimation("Jump"):R.setGameState(a.PLAYING)),l.has(t)&&(R.getGameState()!=a.PLAYING||" "!==t&&"ArrowUp"!==t||R.dino.setAnimation("Jump"),R.getGameState()==a.PLAYING&&"ArrowDown"===t&&R.dino.dinoState==o.RUNNING&&R.dino.setAnimation("Crouch"))}function A(e){let t=e.key;w.delete(t),l.delete(t),R.getGameState()==a.PLAYING&&"ArrowDown"===t&&R.dino.setAnimation("Run"),R.getGameState()!=a.PLAYING||R.dino.dinoState!=o.JUMPING||"ArrowUp"!==t&&" "!==t||(R.dino.dinoState=o.FALLING)}requestAnimationFrame((function e(){let t=performance.now(),i=t-S;S=t,R.getGameState()==a.READY&&(l.has(" ")||document.addEventListener("keydown",I),document.addEventListener("keyup",A)),R.getGameState()!=a.READY&&function(e){R.update(e)}(i),R.render(),requestAnimationFrame(e)}))})();